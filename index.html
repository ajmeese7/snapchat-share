<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FFFC00">
    <link rel="icon" type="image/png" href="ghost.png">

    <link rel="stylesheet" type="text/css" href="index.css" />
    <script src="bundle.js"></script>

    <title>Demo - Snapchat Share</title>
</head>

<body>
    <form>
        <label for="image_url">Image URL:</label><br>
        <input type="text" id="image_url" name="image_url" placeholder="website.com/your_image_url"><br>
        <label for="local_img">Local Image:</label><br>
        <input type="file" id="local_img" name="local_img" accept="image/*"><br>

        <label for="big_text">Big Text:</label><br>
        <input type="text" id="big_text" name="big_text" placeholder="Your text here"><br>
        <label for="small_text">Small Text:</label><br>
        <input type="text" id="small_text" name="small_text" placeholder="Your text here"><br>

        <label for="width">Image Width:</label><br>
        <input type="text" id="width" name="width" pattern="^[0-9]*$" placeholder="1920"><br>
        <label for="height">Image Height:</label><br>
        <input type="text" id="height" name="height" pattern="^[0-9]*$" placeholder="1080"><br>

        <input type="button" value="Create Share!" onclick="prepShareCommand()"><br>
        <!--<input type="button" value="Download Image!" onclick="prepShareCommand()">-->
    </form>

    <script>
        /**
         * This function gets all the values from the inputs and passes them
         * as parameters to the getShareImage function.
         */
        function prepShareCommand() {
            let url = document.getElementById("image_url").value;
            if (!url) url = URL.createObjectURL(document.getElementById("local_img").files[0]);
            let bigText = document.getElementById("big_text").value;
            let smallText = document.getElementById("small_text").value;
            let width = document.getElementById("width").value;
            let height = document.getElementById("height").value;

            share.getShareImage(width, height, url, bigText, smallText);
        }

        /**
         * Takes the canvas and appends it to the body, after clearing
         * out any previous canvases that may have been on the page.
         * @param {element} canvas - the canvas created by getShareImage
         */
        function addCanvasToPage(canvas) {
            [].forEach.call(document.querySelectorAll('canvas'), function(e) {
                // Removes any existing canvases on the page, so only the latest
                // one will show up
                e.parentNode.removeChild(e);
            });

            document.body.appendChild(canvas);

            // TODO: Once I get rid of promsies, I can make this a parameter
            // for the top function and uncomment the download button
            // var link = document.createElement('a');
            // link.download = 'filename.png';
            // link.href = canvas.toDataURL()
            // link.click();
        }
    </script>
</body>

</html>